---
title: Installing the ABySS
author: Zhian N. Kamvar
date: '2017-10-05'
slug: installing-the-abyss
categories:
  - science
  - example
tags:
  - ABySS
  - command line
  - HPC
---



<p>A couple of weeks ago, I wanted to explore assembling 55 genomes of <em>Sclerotinia sclerotiorum</em> to check for structural rearrangements that <a href="https://apsnet.confex.com/apsnet/2017/meetingapp.cgi/Paper/6023">could be caused by sub-lethal fungicide exposure</a>. I figured the best way to do this was to assemble these genomes <em>de novo</em> as opposed to aligning them to a reference. This brought me to installing the <a href="https://github.com/bcgsc/abyss#readme">ABySS</a> <em>de novo</em> assembler on the <a href="https://hcc-docs.unl.edu/display/HCCDOC/HCC+Documentation">HCC Tusker Cluster</a>‚Ä¶ and I can happily report, that after half a day of <a href="http://pgbovine.net/cmdline-bs-example.htm">command line bullshittery</a><a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>, I had ABySS up and running üëç.</p>
<blockquote>
<p>Note: this blogpost will be boring. Stop reading now.</p>
</blockquote>
<p>Because of the idiosyncrasies of the cluster, I figured I would write a post about this for anyone who finds themselves in a similar situation. What do I mean by idiosyncrasies? For PATH management, the cluster uses <a href="http://modules.sourceforge.net/">module management</a>. This means that, in order to use a specific piece of software, I have to load its module first (and all the modules it depends on).</p>
<p>Moreover, the cluster itself is separated into two main filesystems (both run BASH), <code>/home</code> and <code>/work</code>. The <code>/home</code> filesystem is alotted 25GB per user and is meant to store small data sets and programs, but the caveat is that you can only write to this filesystem through the login node. The <code>/work</code> filesystem is alotted 50TB per user and is meant for temporary storage of data from jobs that are sent to the worker nodes.</p>
<p>Because it‚Äôs bad form to compile software on the login node, I wrote submission scripts for compilation in my <code>/work</code> directory and then manually copied the output to the <code>/home</code> directory.</p>
<div id="what-goes-in-the-abyss" class="section level2">
<h2>What goes in the ABySS</h2>
<p>Unlike the HCC documentation, the <a href="https://github.com/bcgsc/abyss#compiling-abyss-from-source">ABySS documentation</a> is fairly straightforward and easy to understand. One of the first things they show is how to install ABySS to a specific directory:</p>
<pre class="bash"><code>./configure --prefix=/path/to/abyss
make
sudo make install</code></pre>
<p>Then they explain the software needed by ABySS and give examples of how to tell the compiler where the software is if it‚Äôs not installed in the expected place on your machine:</p>
<table>
<thead>
<tr class="header">
<th>Program</th>
<th align="right">exists on HCC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>gcc (&gt;= 4.2)</code></td>
<td align="right">‚úîÔ∏è</td>
</tr>
<tr class="even">
<td><code>boost</code></td>
<td align="right">‚úîÔ∏è</td>
</tr>
<tr class="odd">
<td><code>openmp</code></td>
<td align="right">‚úîÔ∏è</td>
</tr>
<tr class="even">
<td><a href="https://github.com/sparsehash/sparsehash"><code>sparsehash</code></a></td>
<td align="right">‚ùå</td>
</tr>
</tbody>
</table>
<p>In this case, we didn‚Äôt have <code>sparsehash</code>, but that‚Äôs OK because we can simply install sparsehash and use:</p>
<pre class="bash"><code>./configure CPPFLAGS=-I/path/to/local/include</code></pre>
</div>
<div id="compiling" class="section level2">
<h2>Compiling</h2>
<p>So my steps were to:</p>
<ol style="list-style-type: decimal">
<li>Unzip and compile sparsehash with <code>--prefix=/work/sparsehash</code></li>
<li>move the results to <code>/home/local/</code></li>
<li>Unzip and compile ABySS with <code>--prefix=/work/abyss CPPFLAGS=-I/home/local/include</code></li>
<li>move abyss to <code>/home/bin</code></li>
</ol>
<p>Simple, right? Now all I have to do is write the scripts to compile these and then move them to their proper places. Well, on my first try, I compiled everything and moved them to their correct places, but ended up with an error when abyss tried to run <code>ABYSS-P</code>, which prompted me to write myself the <a href="https://github.com/zkamvar/read-processing/blob/a1c151952e95f5b4f0c4c3d919c24b5868086170/scripts/make-abyss-assembly.sh#L41-L45">following note</a>:</p>
<pre class="bash"><code># NOTE TO FUTURE ZHIAN:
#
# It appears as if we need to have ABYSS-P installed for the parallel version
# The way we can do that... I think... is by running the installation process
# of abyss on the cluster using openmp</code></pre>
<blockquote>
<p>Note, I‚Äôm using the environment variables <code>${WORK}</code> and <code>${HSH}</code> to mean <code>/work</code> and <code>/home/shared</code>, respectively.</p>
</blockquote>
<pre class="bash"><code>#!/usr/bin/env bash
#SBATCH --job-name=SPAREHASH-BUILD
#SBATCH --time=04:00:00
#SBATCH --output=compilation-jobs/SPAREHASH.out
#SBATCH --error=compilation-jobs/SPAREHASH.err
#SBATCH --mem=4gb
#SBATCH --cpus-per-task=1

module load compiler/gcc/6.1 openmpi/2.1

mkdir -p ${WORK}/compilation-jobs
tar -xzvf ${HSH}/tarballs/sparsehash-2.0.3.tar.gz -C ${WORK}
cd sparsehash-sparsehash-2.0.3/
./configure --prefix=${WORK}/sparsehash
make
make install</code></pre>
<pre class="bash"><code>#!/usr/bin/env bash
#SBATCH --job-name=ABYSS-BUILD
#SBATCH --time=04:00:00
#SBATCH --output=compilation-jobs/ABYSS.out
#SBATCH --error=compilation-jobs/ABYSS.err
#SBATCH --mem=4gb
#SBATCH --cpus-per-task=1

module load compiler/gcc/6.1 openmpi/2.1 boost/1.63

#  Now that we have sparehash compiled, we need to compile ABySS in a similar
#  fashion. Again, I normally use an interactive terminal for this.

       tar -xzvf /home/everhartlab/shared/tarballs/abyss-2.0.2.tar.gz -C ${WORK}
       cd abyss-2.0.2/
       ./configure --prefix=${WORK}/abyss CPPFLAGS=-I/home/everhartlab/shared/local/include
       make
       make install
       make check</code></pre>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>okay, my example isn‚Äôt nearly as bad, but this still took me in a few unexpected directions.<a href="#fnref1">‚Ü©</a></p></li>
</ol>
</div>
